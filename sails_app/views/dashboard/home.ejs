<style type="text/css">
  #map-container {
    width:900px;
    height:350px;
    margin:0px 0px;
  }
</style>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script src="/js/markerclusterer_compiled.js" type="text/javascript"></script>
<script src="/js/markerwithlabel_packed.js" type="text/javascript"></script>
<div class="row">
  <div class="col-xs-8">
    <div id="map-container">
    </div>
  </div>
  <div class="col-xs-4" style="padding-left:25px;">
    <h3>Select a dashboard to view:</h3>
    <ul>
      <% for (var i in dashboards) { %>
        <li>
          <a href="/dashboard/<%= dashboards[i].id %>"><%= dashboards[i].name %></a>
        </li>
      <% } %>
    </ul>
  </div>
</div>

<script>    
  function init_map() {
    $.ajax({
      type: "GET",
      url: "/get_children",
      success: function(data) {
        var orgs = JSON.parse(data);

        var markerIndex = [];
        var centerLocation = new google.maps.LatLng(43.251678,-79.812285);
        var mapOptions = {zoom: 6, center: centerLocation};
        var map = new google.maps.Map($('#map-container')[0],mapOptions);
        var infoWindow = new google.maps.InfoWindow();

        for(var index in orgs) {
          var location = orgs[index]["location"].split(",");
          var marker = new MarkerWithLabel({
            position: new google.maps.LatLng(location[0],location[1]),
            map: map,
            draggable: false,
            raiseOnDrag: false,
            title:orgs[index]["name"]
            // labelContent: "A",
            // labelAnchor: new google.maps.Point(3, 30),
            // labelClass: "labels", // the CSS class for the label
            // labelInBackground: false
          });
          marker.dashboard_id = orgs[index]["id"];
          google.maps.event.addListener(marker, 'click', function() {
            map.setZoom(12);
            map.setCenter(this.getPosition());
            infoWindow.setContent(this.getTitle() + "<div><a style='font-weight:800;' href='/dashboard/" + this.dashboard_id + "'>GO!</a></div>");
            infoWindow.open(map, this);
          });
          markerIndex.push(marker);
        }
        var mcOptions = {gridSize: 50, maxZoom: 15};
        var mc = new MarkerClusterer(map, markerIndex, mcOptions);
      },
      error: function(response) {
        console.log("Error");
        console.log(response);
      }
    });
  }

  init_map();

</script>