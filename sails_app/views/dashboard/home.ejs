<style type="text/css">
  #map-container {
    width:900px;
    height:350px;
    margin:0px 0px;
  }
</style>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<div class="row">
  <div class="col-xs-8">
    <div id="map-container">
    </div>
  </div>
  <div class="col-xs-4" style="padding-left:25px;">
    <h3>Select a dashboard to view:</h3>
    <ul>
      <% for (var i in dashboards) { %>
        <li>
          <a href="/dashboard/<%= dashboards[i].id %>"><%= dashboards[i].name %></a>
        </li>
      <% } %>
    </ul>
  </div>
</div>

<script>    
  function init_map() {
    $.ajax({
      type: "GET",
      url: "/get_children",
      success: function(data) {
        var orgs = JSON.parse(data);
        var markerIndex = [];
        for(var index in orgs) {
          var location = orgs[index]["location"].split(",");
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(location[0],location[1]),
            map: map,
            title:orgs[index]["name"]
          });
          marker.dashboard_id = orgs[index]["id"];
          markerIndex.push(marker);
        }
        var centerLocation = new google.maps.LatLng(43.251678,-79.812285);
        var mapOptions = {zoom: 8, center: centerLocation};
        var map = new google.maps.Map($('#map-container')[0],mapOptions);

        var infoWindow = new google.maps.InfoWindow();

        for(var index in markerIndex) {
          markerIndex[index].setMap(map);
          google.maps.event.addListener(markerIndex[index], 'click', function() {
            map.setZoom(12);
            map.setCenter(this.getPosition());
            console.log(this.getTitle());
            infoWindow.setContent(this.getTitle() + "<div><a style='font-weight:800;' href='/dashboard/" + this.dashboard_id + "'>GO!</a></div>");
            infoWindow.open(map, this);
          });
        }
      },
      error: function(response) {
        console.log("Error");
        console.log(response);
      }
    });
  }

  init_map();

</script>